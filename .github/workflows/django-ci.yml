---
    name: Django CI
    on:
      push:
        branches:
          - development
      pull_request:
        branches:
          - development
    jobs:
      build:
        runs-on: ubuntu-latest
        strategy:
          matrix:
            python-version:
              - 3.13
        steps:
          - uses: actions/checkout@v3
            with:
              fetch-depth: 0

          - name: Set up Python ${{ matrix.python-version }}
            uses: actions/setup-python@v4
            with:
              python-version: ${{ matrix.python-version }}
          - name: Clear pip cache
            run: |
                pip cache purge
          - name: Install Dependencies
            run: |
              python -m pip install --upgrade pip
              pip install -r requirements.txt
          - name: Run Migrations
            run: |
              python manage.py makemigrations
              python manage.py migrate
          - name: Run Tests and Generate Coverage
            run: |
              coverage run manage.py test
              coverage xml
          #- name: Run Tests
          #  run: |
          #    python manage.py test
          #- name: Lint with flake8
          #  run: >
          #    pip install flake8
    
              # stop the build if there are Python syntax errors or undefined names
    
           #   flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
    
              # exit-zero treats all errors as warnings
    
           #   flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics
          - name: SonarQube Scan
            if: github.event.pull_request.base.ref == 'development' || github.event_name == 'push'
            uses: SonarSource/sonarqube-scan-action@v5
            env:
              SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
            with:
              args: >
                -Dsonar.projectKey=cordorat_Serviwatch
                -Dsonar.python.coverage.reportPaths=coverage.xml
                -Dsonar.sources=.
                -Dsonar.exclusions=**/migrations/**,venv/**,**/tests/**,**/js/**,**/static/js/**,**/node_modules/**
                -Dsonar.cpd.exclusions=**/*.html
                -Dsonar.host.url=https://sonarcloud.io
                -Dsonar.organization=desprogramadores
                -Dsonar.branch.name=development
                
